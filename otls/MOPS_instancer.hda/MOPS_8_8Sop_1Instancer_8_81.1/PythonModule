import re

def onInstancePathChanged(kwargs):
    node = kwargs['node']
    parm = kwargs['parm']
    
    """ 
    get updated instance path, if it's an OBJ and not a SOP,
    see if there's a material applied to that OBJ.
    if there is, we're going to apply that as the override
    material for this layer. 
    """
    
    newPath = parm.eval()
    assigned = False
    # get number of modified multiparm
    test = re.match('^.+?(\d+)$', parm.name())
    num = -1
    if test:
        num = test.groups()[0]
        override_parm = node.parm('instance_material'+num)
                    
    if hou.node(newPath) is not None and override_parm:
        newType = hou.node(newPath).type().name()
        if newType == 'geo':
            # get this object's material assignment
            mat = hou.node(newPath).parm('shop_materialpath').eval()
            if mat:
                # apply as override to instance_material#
                override_expr = '`chsop("{}/shop_materialpath")`'.format(newPath)
                override_parm.set(override_expr, follow_parm_reference=True)
                assigned = True
    if not assigned:
        override_parm.revertToDefaults()
            
        